# 关于电脑的待机、睡眠、休眠，这篇应该可以解答你所有的疑问

*全文摘自知乎*

## 前提

为了解释清楚本文主题，我不得不先花一点时间点拨一些必须的基础概念，因为下头的很多系统行为的描述需要依赖这些概念。

一套计算机硬件可以认为是 3+1 的结构。3 表示三种基础部件：CPU，内存，外围设备（简称外设），1 表示硬盘。

**CPU**： 相当于人的大脑中负责做决定的那个功能部件。计算机下一个时间点要做什么事（屏幕上显示一个图形，还是联网下载一首歌曲），其动作指令是由 CPU 发出的。

**内存**： 相当于人大脑中的记忆。全称叫 RAM, Random-Access Memory 的缩写。比如你用电脑在编辑一份文档，当文档还未存盘时，文档的内容是放在内存中的，Ctrl+S 存盘后才被写入硬盘。

对应到具体的硬件上，内存就是电脑商店里卖的“内存条”，Windows 和 Mac 电脑通常会配备 4, 8, 或 16GB 的 RAM。iPhone 6 只有 1GB RAM，到 iPhone 6S 时增大到 2GB。

**外设**：比如键盘、鼠标、网卡、摄像头、声卡、显示器、打印机等。CPU 执行的动作最终需要被人感知（比如播放一个影片让人看到），而人发出的指令也需要传达给 CPU （比如要求发送一段文字给 QQ 好友），各种各样的外设充当了人和 CPU 之间信息交换的接口。

## 四种运行状态

这四种运行状态（或称电源状态）是：

1. 工作状态 (Working), S0
2. 睡眠状态 (Sleep), S1 或 S3
3. 休眠状态 (Hibernate), S4
4. 关机状态 (Shutdown), S5

请注意：以上四种状态中，并没有一种被我叫作“待机状态”，因为“待机”这个词是有歧义的，因此我避免使用它。

在 Windows 2000 和 Windows XP 中，『开始』菜单→关机选项中确实有一项被叫作“待机(Standby)”，它的效果实际上等同于睡眠(Sleep)。微软后来应该是也觉得 Standby 这个提法有歧义，因此从 Vista 起就将其改名为“睡眠(Sleep)”。由于 Windows XP 的影响很深远，有些软硬件厂商一直用 Standby 来指代 Sleep ，直到今天。现在，请暂时忘掉“待机”这个提法，本文最后一部分回头再讨论这个词。

**工作状态**就是一个系统的全功能状态，用户让它干什么它马上就干什么，只要是这个系统的软硬件能力范围之内。形象地说，用户敲一个按键或移动一下鼠标，屏幕上立即就有相应的反馈。

**睡眠状态**的特征是： CPU 停止执行指令，内存中的东西原样留在内存中。

睡眠状态意味着：

1. 你的未存盘文档没有丢失，它留在你的内存中。
2. 后台的所有程序暂停执行，比如，后台的下载程序暂停下载动作，QQ 也不再能收到好友消息。
3. 你可以敲一下键盘将系统唤醒。（点击或移动鼠标不一定能唤醒系统，看具体情况）
4. 在系统被唤醒前，如果断电，内存中的信息将全部丢失，因为内存中的信息需要少量电力来维持。换言之，你的未存盘文档的未存盘部分将丢失。
5. 系统唤醒后，所有的系统状态恢复成睡眠前的样子。你之前打开的所有应用程序窗口都留在原处，里头的内容也没变，你可以继续编辑未存盘的文档，就好像系统并未经历过睡眠那般。

**休眠状态**和**睡眠状态**的大部分特征是相同的，区别之处在于：原先睡眠状态下留在内存中的信息被原样写入硬盘，休眠完成后系统自身进入零耗电状态；唤醒系统时，硬盘中的内存镜像被原样装入内存，系统恢复运行。

这意味着：

- 系统执行“进入休眠”这个操作，所花费的时间比“进入睡眠”要长很多，毕竟多了个“写硬盘”的动作。如果电脑上的硬盘是机械硬盘，写入速度算 100MB/s，内存大小是 4GB，那么，写硬盘时间可长达 40 秒。Windows 7 起有个改进，会将内存数据压缩后再写入硬盘，通常会节省一半的时间，即 20 秒，另外，当前没用到的内存块也不会被写入硬盘，又能再节省一些时间。
- 休眠完成后，即使你拔掉电源线，未存盘的文档也不会丢失，因为数据已经存在硬盘上了。

**关机状态**：在 Windows 7 及之前版本的 Windows 上，开始菜单→关机，就是进入这种状态。关机将导致内存中的数据全部被清空，因此，应用程序会提示你保存未存盘的文档；如果你发现文档还需要修改修改才值得保存，你可以趁此机会取消刚才的关机请求。

## **两种变体**


本节要解释的是 Windows 电源状态的两种变体。

- Windows Vista 时引入的“混合睡眠”。
- Windows 8 时引入的“快速关机”。

### 混合睡眠

拿 Windows 的截图说明，在高级电源设置中，有个“允许混合睡眠”选项。

“允许混合睡眠”打开，你将发现开始菜单→关机选项中故意不给你显示“休眠”了（当然，这不是本质问题，我们仍旧可以用 shutdown /h 命令来明确要求休眠）。
“允许混合睡眠”打开后，你在开始菜单中执行“睡眠”，其实际动作是执行混合睡眠（之前的那种睡眠，不妨起名叫“经典睡眠”）。混合睡眠的特征是：**不但将原有内存数据留在内存中，同时也将内存数据写一份到硬盘中**。

混合睡眠带来的好处是：

- 如果睡眠后你的电脑供电一直没断，那么，唤醒的速度将很快，2~3 秒，因为所有的工作状态一直留在内存中。
- 如果睡眠后你的电脑断电了，那么也不要紧，唤醒时将从硬盘中装入睡眠前的内存状态，你的工作数据也不会丢失，只不过唤醒时间较长罢了。此时的断电相当于是让系统自动进入了休眠状态。
- 既然断电不要紧，我们就可以设一个 60 分钟的定时器（上一张图“在此时间后休眠”），让系统在进入混合睡眠 60 分钟后将自己断电，避免长时间无人使用电脑导致的电力消耗。想象一个有 100 台电脑的公司，每台 5~10W 的电力节省是很可观的。

缺点：

当我们只需要 Sleep 电脑一小会儿就唤醒它的情况下，进入混合睡眠的时间显然要长于经典睡眠。另外，对于安装了巨量内存（比如 32GB）的机器、且内存用得很满的情况下，往硬盘中写入和读取休眠文件的耗时相当之久，也许用户会更甘愿多消耗一些电力来换取每次“开机/关机”的迅捷。

### 快速关机(快速启动)

Windows 8、10在基于早期版本中「混合睡眠」模式的基础上实现了「快速启动」功能。通过将操作系统状态保存到「休眠文件」中，唤醒系统时只需要将系统加载到内存中，不需要每次都从头初始化系统，从而节省开机时间。当再次唤醒系统是 Windows 就不必重新加载这些核心，只需要将「休眠文件」重新加载到内存即可。因此「快速启动」才能同时兼顾关机速度和开机速度。

Fast Shutdown 的正式称呼是 Fast Startup (快速开机) 或 Fast Boot 。 我为什么喜欢叫它 Fast Shutdown 呢？因为它更体现本质，Fast Shutdown 是 Fast Startup 的前提。
Windows 8 刚出来的那阵子，你是否听到网上说 Windows 8 的开机/关机速度比 Windows 7 快了很多，你自己尝试了，也确实体会到了。那你知道快的原理在何处吗？

![img](https://pic2.zhimg.com/v2-dcd7c255e0aa78a9d15943e139dd0a2d_r.jpg)

Fast Shutdown 开启的情况下，当你执行 开始菜单→关机时，Windows 干的其实是下面两件事：

- 一，退出当前用户的会话，所谓的 Log off （Windows 10 起改名叫 Sign out，中文 Windows 翻译成”注销“）。注销的效果，简单说就是关闭所有前台程序，但内核和后台服务仍在运行。
- 二，让 Windows 休眠。

对 Windows 8+ 执行关机再开机，其效果不再等同于”重启“。具体影响是：当 Windows 内核自身、驱动程序、或后台服务出现故障的情况下，Windows 8+ 执行关机再开机无法消除那些错误，因为休眠唤醒的过程中，Windows 内核、驱动程序、和后台服务并未重新初始化。

### 快速启动的bug

理解「快速启动」的原理后就，就不难理解为什么这个功能会导致众多小 bug 了，正是因为系统从未真正关机，系统内核从未重置，让一些 bug 或导致 bug 的错误也得以保留。这就是为什么有些人的电脑开机后需要**重启一次才能恢复正常**，因为上一次关机并不是真正的关机，而重启的关机才是真正的关机。

快速启动可能会导致许多意想不到的bug，如**关机后黑屏但风扇不停转**。在开启此项的时候，按住 Shift 键同时点击开始菜单中的关机按钮，可临时执行一次“彻底关机”。**注意是系统中的「关机」，不是电脑上的物理按键**！

![img](https://pic4.zhimg.com/80/v2-d1999b570093b26af55304edf8333e8f_1440w.webp)

