# 图解B树的原理及操作

*来自[知乎](https://zhuanlan.zhihu.com/p/146252512)和[CSDN](https://blog.csdn.net/jinking01/article/details/115130286)*

B树就是B-树，"-"是个连字符号，不是减号。

## 概念

- 根节点（root）：**没有父节点**的节点叫做根节点
- 叶子节点（leaf）：**没有子节点**的节点叫做叶子节点
- 内部节点（internal）：**除根节点和叶子节点之外的节点**叫做内部节点。它们即有父节点，也有子节点。
- 键：B树中的**存储元素**是键，是用于指向数据记录的指针。键的值是用于存储真正的数据记录。一个节点中可以拥有多个键。
- 阶：B树的阶为**最大子节点数量**，其比**键的数量大1**。我们一般称一个B树为M阶的B树，那么该B树**最多拥有M个子节点，节点中最多拥有M-1个键**。

![](img/btree.png)

B树是一种自平衡的树，能够保持数据有序。这种数据结构能够让查找数据、顺序访问、插入数据及删除的动作，都在对数时间内完成。

B树与AVL树不同，可以拥有2个以上的子节点，并且每个节点可以有多个键值，这些属性减少了定位记录时所经历的中间过程，加快了存取速度。B树更适用于读写相对较大的数据块存储系统，如磁盘。**这种数据结构常被应用在数据库和文件系统的实现上**。

## B树的特性

- 每个**节点最多有 M 个子节点**；每个**内部节点最少有 ⌈M/2⌉ 个子节点**（⌈x⌉为向上取整符号）；如果根节点不是叶子节点，那么它至少有**两个子节点**。
- 具有 N 个子节点的非叶子节点拥有 N-1 个键。
- 所有叶子节点必须处于同一层上。

如下图是一棵5阶B树的两种画法，最准确的画法应该为图中左B树。但为了方便，通常会将节点中键为空的位置省去不画，如图中右B树。不能因为右图中最多的键为3，就判断这是一棵4阶B树，B树的阶是预先定义好的。

![](https://pic1.zhimg.com/v2-69400b2c5f47bf7b0fe017f2eff1b924_r.jpg)

对于 M 阶 B 树：

|     项目      |      最少        |      最多         |
|:-------------:|:---------------:|:-----------------:|
|  内部节点数量   |   ceil(M/2) - 1  |       M - 1       |
|  全部关键字数量 |   ceil(M/2) - 1  |       M - 1       |
|  节点子树数量   |     ceil(M/2)    |        M          |
|  根关键字数量   |     1            |        --         |
|  根关键字范围   |     1            |       M - 1       |
|  子树取值范围   |     2            |         M         |

最小高度：$h \le \log_m{(n+1)}$

最大高度：$h \le 1 + \log_{\lceil\frac m2\rceil} \frac {n+1}{2}$